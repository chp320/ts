# 엘라스틱 스택 개발부터 운영까지
- 회사 시스템에 다양한 서비스들이 운영 중인데 마땅한 APM 툴이 없어 실시간 모니터링이 불가한 상황이다.
- APM 툴을 적용할 수 있겠으나 단순히 APM 툴만 적용하기 보다는 시스템별로 산재한 로그를 수집/분석에 대한 needs도 있어 도서를 통해 정리해본다.

## 엘라스틱 스택이란?
### 엘라스틱 서치
- 인터넷이 발전함에 따라 사이트 내에서 전문 검색(full text search)에 대한 요구사항이 대두 되었고
- 기업들은 대량의 DB나 파일 시스템 검색을 위해 벤더가 제공하는 비싼 솔루션 의존이 커짐에 따라 새로운 검색 엔진의 필요성이 커짐
- http상에서 json으로 interface 지원, java 외 다른 프로그래밍 언어 지원하는 솔루션인 엘라스틱 서치가 2010년 2월 공개

### 엘라스틱 스택
- 대량의 데이터를 수집, 가공, 저장, 분석, 시각화하는 일련의 파이프라인을 구성하기 위한 조합이 필요했고
- ElasticSearch, Logstash, Kibana 를 합친 '엘라스틱 스택(Elastic Stack)'이 나타남

### 엘라스틱 스택 구성요소
<img src="https://github.com/chp320/ts/assets/47440517/f73039b4-8072-491b-8f17-76133ffad3f9" />

- 엘라스틱 서치는 내부적으로 모든 레코드를 json형태로 관리하고 있고, 쿼리한 결과에 대해 일치하는 내용을 반환한다.
  - 검색 엔진이면서 데이터베이스이기도 하고 텍스트 외 다양한 데이터 타입에 대해 최적화되어 있어 일종의 NoSQL DB로 봐도 무방
- 키바나는 엘라스틱 서치 기반의 시각화 도구로 엘라스틱 스택의 UI를 담당
  - 시각화 도구를 사용해 커스텀 대시보드 구성이 가능하고, 성능 모니터링을 위한 APM 등의 기능 활용 가능
- 로그스태시는 데이터 수집과 가공을 처리하며 특히 다양한 소스로부터 로그 수집이 가능
<img src="https://github.com/chp320/ts/assets/47440517/f5e03955-7ece-4f65-b5f7-1c7f45efbf58" />

- 비치는 경량화된 수집 도구로 상대적으로 무거운 로그스태시를 대신해 각 서비스 호스트에 부담없이 설치 가능
  - 일반적으로 '비츠'로 데이터를 수집하고 '로그스태시'로 가공해 '엘라스틱서치'로 전송하는 아키텍처로 구성됨
<img src="https://github.com/chp320/ts/assets/47440517/bf923f96-daf5-4ae1-83c2-28e1db82b120" />

## 유사 제품과 비교
### 엘라스틱 서치의 유사 제품군
- 엘라스틱 서치는 검색엔진이자 데이터 저장 가능한 NoSQL DB로도 볼 수 있음
- 엘라스틱 서치는 데이터를 빠르게 검색 & 집계하는데 최적화되어 있고, 그에 따라 많은 리소스를 사용하기 때문에 일반적인 DB처럼 사용하기엔 무리가 있음 → 기 발생 데이터는 변하지 않는 시계열 데이터 유형 다루기에 적합
- MySQL이나 PostgreSQL과 같은 오픈소스 RDB에서도 json 형식을 지원하고 있어 document 저장 목적으로도 일부 사용 가능함

### 로그스태시/비츠의 유사 제품군
- 플루언트디(Fluendtd)는 로그스태시와 설정상 차이가 있을 뿐 기능상으로는 거의 동일한 역할을 수행
- 로그스태시는 엘라스틱서치, 키바나와 연계해 모니터링, 중앙관리 등의 기능을 제공하지만 플루언트디는 이러한 지원은 불가
  - 로그스태시가 엘라스틱 스택의 일부라면, '플루언트디'는 CNCF 스택으로 클라우드 환경 구성 시 쿠버네티스, 프로메테우스와 시너지 가능
 
### 키바나의 유사 제품군
- 그라파나(Grafana)는 엘라스틱서치 외에 다양한 시계열 DB 활용 가능
- 태블로(Tableau)는 실시간 모니터링에 초점을 맞춘 '키바나', '그라파나'와 달리 엑셀이나 RDB 등 주로 정적인 파일을 분석해서 시각화하는데 사용됨

```
결국 사용 목적에 맞는 tool을 도입하여 적용하는 것이 관건이며,
아직 회사에서는 클라우드 기반이 아니고 많은 레퍼런스 확인 가능한 'ELK' 구성으로 가고자 한다.
```

## 엘라스틱 스택 환경 구성
- 엘라스틱 스택에 포함되는 제품은 OS 종속이 거의 없는 편이지만 엘라스틱에서 공식적으로 동작을 보증하는 환경(서포트 메트릭스)이 있으니 확인 필요!
  - ElasticSearch: java, Logstash: jruby, Kibana: javascript, Beats: Golang

