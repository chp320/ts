# 스프링 시큐리티 : 토큰 기반 인증

## 사전 지식 - 토큰 기반 인증
1. 사용자 인증 확인 방법에는 '서버 기반 인증'과 '토큰 기반 인증' 이 있음
2. 스프링 시큐리티는 기본적으로 '세션 기반 인증' 제공함 (폼 로그인 인증.은 세션 기반 인증 예시)
3. 토큰 기반 인증 - '토큰'을 사용하는 방법
   * 토큰: 서버에서 클라이언트를 구분하기 위한 유일한 값
   * 서버 토큰 생성 > 클라이언트에 제공 > 클라이언트는 서버 요청 시 '토큰'과 함께 전송 > 서버는 유효한 사용자 여부 검증
   * 토큰 전달/인증 flow
![image](https://github.com/chp320/ts/assets/47440517/b244382b-267f-4432-994f-445b4c53140d)

   * 토큰 기반 인증 - 무상태성/확장성/무결성
     1) 무상태성
        - 사용자 인증 정보는 토큰에 담겨 클라이언트에서 유지하고 있으므로 서버는 데이터 유지 필요성x
        - 서버 기준에서 사용자 상태를 관리할 필요 없어 '무상태성(stateless)'을 가짐
     2) 확장성
        - 서버는 상태 관리가 불필요하므로 서버 확장에도 용이
     3) 무결성
        - 토큰은 발급 이후 변경이 불가하기 때문에 '토큰의 무결성'이 보장됨
        - 토큰 방식은 HMAC(hash-based message authentication)이라고도 함
       
<hr>

4. JWT - JSON Web Token
   * JWT 로 인증을 위해서는 HTTP request 헤더 내 [ key: Authorization, value: 'Bearer + JWT 토큰값' ] 넣어 전송 필요
   * JWT 구조 - 헤더(header)/내용(payload)/서명(signature)
![image](https://github.com/chp320/ts/assets/47440517/d6cf5bb3-07a1-446e-9439-91fd85cea9fc)
  
     1) 헤더
        - 토큰 타입, 해싱 알고리즘 정보
        - key: typ(토큰 타입), alg(해싱 알고리즘)
     2) 내용
        - 토큰과 관련된 정보
        - 내용 한 덩어리를 '클레임(claim)' 이라 부르며 "key-value" 쌍으로 구성
        - 클레임은 등록된 클레임/공개 클레임/비공개 클레임 으로 구분됨
          - 등록된 클레임 : 토큰에 대한 정보 (ex. iss, iat, exp, ..)
          - 공개 클레임 : 공개되어도 무방한 정보. 보통의 경우 클레임 이름은 URI 로 작성
          - 비공개 클레임 : 공개 불가한 정보. 서버-클라이언트 통신에 사용
     3) 서명
        - 해당 토큰이 조작되었거나 변경되지 않았음을 확인하는 용도로 사용
        - 헤더의 인코딩 값과 내용의 인코딩 값을 합친 후 주어진 '비밀키'를 사용해 해시값 생성
       
   * 리프레시 토큰, 엑세스 토큰
     - 토큰은 발급되면 그 자체로 인증 수단이 되기 때문에 유효기간을 두는데 너무 길거나 너무 짧으면 사용에 제약이 있으므로 '리프레시 토큰' 을 사용함
     - 사용자 인증을 위한 '엑세스 토큰'이 만료되었을 때 새로운 엑세스 토큰 발급을 위해 '리프레시 토큰'을 사용
       - 보통 엑세스 토큰의 유효기간은 '짧게', 리프레시 토큰의 유효기간은 '길게' 설정하여 안정성 높임 
   * 토큰 발급 flow
![image](https://github.com/chp320/ts/assets/47440517/4aabfe52-a323-449b-a7fc-d4f1b72d2055)
  
   * ㅇㅇㅇ
   * ㅇㅇㅇ



